{
  "description": "## Implementa√ß√£o do Use Case generateFeatureSummary\n\n### Objetivo\nCriar a l√≥gica de neg√≥cio principal para gera√ß√£o de resumos de features utilizando DeepSeek Reasoner, com foco em an√°lise profunda de tasks e coment√°rios.\n\n### Escopo\n1. **FeatureRepository**:\n   - Adicionar m√©todo `findByIdWithTasksAndComments(featureId, orgId)`\n   - Trazer tasks com `description`, `status`, `type`\n   - Trazer `comments` recentes (limitar a 10 √∫ltimos ou por data)\n\n2. **Use Case `generateFeatureSummary`**:\n   - Local: `src/domain/use-cases/ai/generate-feature-summary.ts`\n   - Input: `featureId`, `forceRegenerate`\n   - L√≥gica: Filtrar dados irrelevantes, formatar prompt para Reasoner.\n   - **Prompt**: Foco em \"O que aconteceu?\", \"Bloqueios resolvidos\", \"Discuss√µes nos coment√°rios\". Ignorar status do √âpico.\n\n### Crit√©rios de Aceite\n- [ ] Repository retorna dados aninhados corretamente sem N+1\n- [ ] Use Case formata o prompt seguindo as diretrizes de \"An√°lise de Tarefas\"\n- [ ] Prompt instrui o modelo a usar emojis e ser direto\n- [ ] Testes unit√°rios cobrindo o fluxo de dados\n\n---\n\n## ‚ö†Ô∏è BLOQUEADO - Code Review\n\n**Issues Cr√≠ticos Encontrados:**\n\n### Ì¥¥ CRITICAL #1: Tipo de retorno n√£o especificado\n```typescript\nexport async function generateFeatureSummary(\n  input: GenerateFeatureSummaryInput,\n  deps: Deps\n) { // ‚Üê Falta : AsyncGenerator<string>\n```\n**Impacto**: TypeScript n√£o valida o tipo de retorno, pode quebrar se mudar implementa√ß√£o sem perceber.\n\n**Fix necess√°rio**:\n```typescript\nexport async function* generateFeatureSummary(\n  input: GenerateFeatureSummaryInput,\n  deps: Deps\n): AsyncGenerator<string> {\n```\n\n### Ìø° HIGH-RISK #2: Truncamento de descri√ß√£o muito agressivo\n```typescript\nDesc: ${t.description ? t.description.slice(0, 100) + '...' : 'Sem descri√ß√£o'}\n```\n**Impacto**: 100 caracteres perde contexto importante (especifica√ß√µes de bugs, decis√µes t√©cnicas).\n\n**Sugest√£o**: Aumentar para 300 caracteres ou usar primeiras 5 linhas:\n```typescript\nconst truncateDesc = (desc: string | null) => {\n  if (!desc) return 'Sem descri√ß√£o';\n  const lines = desc.split('\\n').slice(0, 5).join('\\n');\n  return lines.length > 300 ? lines.slice(0, 300) + '...' : lines;\n};\n```\n\n### Ìø° HIGH-RISK #3: Sem valida√ß√£o de feature vazia\n**Problema**: Se `feature.tasks.length === 0`, AI recebe contexto vazio e gera resposta gen√©rica in√∫til.\n\n**Sugest√£o**: Early return ou aviso no prompt:\n```typescript\nif (feature.tasks.length === 0) {\n  throw new Error('Feature sem tasks. Adicione pelo menos uma task antes de gerar resumo.');\n}\n```\n\n### A√ß√µes Necess√°rias:\n1. Adicionar tipo expl√≠cito `AsyncGenerator<string>` na fun√ß√£o\n2. Melhorar truncamento de descri√ß√µes (m√≠nimo 200 chars ou 3 linhas)\n3. Validar feature.tasks.length > 0 antes de chamar AI\n4. Rodar typecheck ap√≥s fix: `npx tsc --noEmit`\n\n**Status**: Implementa√ß√£o est√° 90% correta, mas precisa desses ajustes cr√≠ticos antes de produ√ß√£o."
}
