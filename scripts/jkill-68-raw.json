{"success":true,"data":{"id":"f13af4e3-e300-4165-897c-aeb5ff05c4bc","orgId":"11111111-1111-1111-1111-111111111111","projectId":"9f6d9015-b19a-441c-a8d1-52d507d50eda","featureId":"22c3ef25-7916-4f50-aa65-97e175942660","localId":68,"title":"Backend: Feature Repository & AI Use Case","description":"## Implementação do Use Case generateFeatureSummary\n\n### Objetivo\nCriar a lógica de negócio principal para geração de resumos de features utilizando DeepSeek Reasoner, com foco em análise profunda de tasks e comentários.\n\n### Escopo\n1. **FeatureRepository**:\n   - Adicionar método `findByIdWithTasksAndComments(featureId, orgId)`\n   - Trazer tasks com `description`, `status`, `type`\n   - Trazer `comments` recentes (limitar a 10 últimos ou por data)\n\n2. **Use Case `generateFeatureSummary`**:\n   - Local: `src/domain/use-cases/ai/generate-feature-summary.ts`\n   - Input: `featureId`, `forceRegenerate`\n   - Lógica: Filtrar dados irrelevantes, formatar prompt para Reasoner.\n   - **Prompt**: Foco em \"O que aconteceu?\", \"Bloqueios resolvidos\", \"Discussões nos comentários\". Ignorar status do Épico.\n\n### Critérios de Aceite\n- [ ] Repository retorna dados aninhados corretamente sem N+1\n- [ ] Use Case formata o prompt seguindo as diretrizes de \"Análise de Tarefas\"\n- [ ] Prompt instrui o modelo a usar emojis e ser direto\n- [ ] Testes unitários cobrindo o fluxo de dados\n\n---\n\n## ⚠️ BLOQUEADO - Code Review\n\n**Issues Críticos Encontrados:**\n\n### ��� CRITICAL #1: Tipo de retorno não especificado\n```typescript\nexport async function generateFeatureSummary(\n  input: GenerateFeatureSummaryInput,\n  deps: Deps\n) { // ← Falta : AsyncGenerator<string>\n```\n**Impacto**: TypeScript não valida o tipo de retorno, pode quebrar se mudar implementação sem perceber.\n\n**Fix necessário**:\n```typescript\nexport async function* generateFeatureSummary(\n  input: GenerateFeatureSummaryInput,\n  deps: Deps\n): AsyncGenerator<string> {\n```\n\n### ��� HIGH-RISK #2: Truncamento de descrição muito agressivo\n```typescript\nDesc: ${t.description ? t.description.slice(0, 100) + '...' : 'Sem descrição'}\n```\n**Impacto**: 100 caracteres perde contexto importante (especificações de bugs, decisões técnicas).\n\n**Sugestão**: Aumentar para 300 caracteres ou usar primeiras 5 linhas:\n```typescript\nconst truncateDesc = (desc: string | null) => {\n  if (!desc) return 'Sem descrição';\n  const lines = desc.split('\\n').slice(0, 5).join('\\n');\n  return lines.length > 300 ? lines.slice(0, 300) + '...' : lines;\n};\n```\n\n### ��� HIGH-RISK #3: Sem validação de feature vazia\n**Problema**: Se `feature.tasks.length === 0`, AI recebe contexto vazio e gera resposta genérica inútil.\n\n**Sugestão**: Early return ou aviso no prompt:\n```typescript\nif (feature.tasks.length === 0) {\n  throw new Error('Feature sem tasks. Adicione pelo menos uma task antes de gerar resumo.');\n}\n```\n\n### Ações Necessárias:\n1. Adicionar tipo explícito `AsyncGenerator<string>` na função\n2. Melhorar truncamento de descrições (mínimo 200 chars ou 3 linhas)\n3. Validar feature.tasks.length > 0 antes de chamar AI\n4. Rodar typecheck após fix: `npx tsc --noEmit`\n\n**Status**: Implementação está 90% correta, mas precisa desses ajustes críticos antes de produção.","status":"REVIEW","type":"TASK","priority":"HIGH","points":null,"modules":[],"assigneeId":"b7d65a91-7cb6-4583-b46d-4f64713ffae2","createdBy":null,"createdAt":"2026-01-11T19:58:01.719Z","updatedAt":"2026-01-12T05:53:31.603Z","blocked":true,"statusChangedAt":"2026-01-11T20:01:32.669Z","assignee":{"displayName":"Gepeto","avatarUrl":null},"feature":{"id":"22c3ef25-7916-4f50-aa65-97e175942660","title":"Resumo de Feature com IA (DeepSeek Reasoner)","epic":{"id":"25213c26-04cb-4710-a630-87bebc761c82","title":"Integração com IA","project":{"id":"9f6d9015-b19a-441c-a8d1-52d507d50eda","name":"Jira Killer","key":"JKILL","modules":["frontend","database","ux/ui"]}}},"comments":[],"readableId":"JKILL-68"}}